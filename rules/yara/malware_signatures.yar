rule Generic_Suspicious_Strings {
    meta:
        description = "Detects generic suspicious strings often found in malware"
        author = "MalAnalyzer"
        reference = "Internal Research"
        severity = "Medium"
        
    strings:
        $cmd1 = "cmd.exe" nocase
        $cmd2 = "powershell" nocase
        $cmd3 = "wscript" nocase
        $reg1 = "RegCreateKeyEx" nocase
        $reg2 = "RegSetValueEx" nocase
        $net1 = "WinSock" nocase
        $net2 = "WSAStartup" nocase
        $net3 = "InternetOpen" nocase
        $net4 = "InternetConnect" nocase
        $inject1 = "VirtualAlloc" nocase
        $inject2 = "WriteProcessMemory" nocase
        $inject3 = "CreateRemoteThread" nocase
        
    condition:
        uint16(0) == 0x5A4D and // Check for MZ header
        (
            (2 of ($cmd*)) or
            (2 of ($reg*)) or
            (2 of ($net*)) or
            (2 of ($inject*))
        )
}

rule Potential_Ransomware {
    meta:
        description = "Detects potential ransomware indicators"
        author = "MalAnalyzer"
        reference = "Internal Research"
        severity = "High"
        
    strings:
        $ransom1 = "encrypt" nocase
        $ransom2 = "decrypt" nocase
        $ransom3 = "bitcoin" nocase
        $ransom4 = "ransom" nocase
        $ransom5 = "payment" nocase
        $ext1 = ".encrypted" nocase
        $ext2 = ".locked" nocase
        $ext3 = ".crypt" nocase
        
    condition:
        uint16(0) == 0x5A4D and // Check for MZ header
        (
            (3 of ($ransom*)) or
            (1 of ($ext*) and 2 of ($ransom*))
        )
}

rule Potential_Keylogger {
    meta:
        description = "Detects potential keylogger functionality"
        author = "MalAnalyzer"
        reference = "Internal Research"
        severity = "High"
        
    strings:
        $key1 = "GetAsyncKeyState" nocase
        $key2 = "GetKeyboardState" nocase
        $key3 = "keylog" nocase
        $key4 = "SetWindowsHookEx" nocase
        $key5 = "WH_KEYBOARD" nocase
        
    condition:
        uint16(0) == 0x5A4D and // Check for MZ header
        2 of them
} 